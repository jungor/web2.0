$(function(){var a=4,b=400,c='url("sao.jpg")',f=null,g=null,h=$("#puzzlearea"),i=h.children(),j=$("#shufflebutton"),k=$('<select name="image" id="imageselect"><option value="sao" selected="selected">sao</option><option value="alo">alo</option><option value="ggo">ggo</option><option value="uw">uw</option></select>'),l=$("#controls"),m=$("<div></div>"),n=function(){steps=0,c="url("+k.val()+".jpg)",m.css({top:"300px",left:"300px"}),i.each(function(d,e){$(e).addClass("puzzlepiece").css({top:Math.floor(d/a)*(b/a)+"px",left:d%a*(b/a)+"px","background-size":"400px 400px","background-image":c,"background-position":-d%a*(b/a)+"px "+-Math.floor(d/a)*(b/a)+"px","user-select":"none"})}),p()},o=function(c){return m.css("top")===c.css("top")&&Math.abs(parseInt(m.css("left"))-parseInt(c.css("left")))===b/a||m.css("left")===c.css("left")&&Math.abs(parseInt(m.css("top"))-parseInt(c.css("top")))===b/a},p=function(){i.each(function(a,b){$(b).off("click",s).removeClass("movablepiece"),o($(b))&&$(b).on("click",s).addClass("movablepiece")})},q=function(){var c=!0;return i.each(function(d,e){($(e).css("top")!==Math.floor(d/a)*(b/a)+"px"||$(e).css("left")!==d%a*(b/a)+"px")&&(c=!1)}),g=new Date,c},r=function(){i.css("display","none"),h.css("background-image","url(congratulation.jpg)"),alert("Your steps: "+steps+"\nYour time: "+(g-f)/1e3+"s"),setTimeout(function(){steps=0,h.css("background-image",""),i.css("display","block")},1e3)},s=function(a){var b=$(a.target),c={top:m.css("top"),left:m.css("left")};m.css({top:b.css("top"),left:b.css("left")}),a.clientX?(steps++,b.animate(c,100,function(){p(),q()&&r()})):(b.css(c),p())},t=function(){f=new Date;for(var b=200;b--;){var c=Math.round(Math.random()*($(".movablepiece").length-1));$(".movablepiece").get(c).click()}};j.on("click",t),k.on("change",n).appendTo(l),n()});